
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Reglas de Acceso Público (solo lectura)
    // Permite que la página de inicio cargue su contenido y planes para cualquier visitante.
    match /landing_configs/{docId} {
      allow read: if true;
      allow write: if request.auth != null; // Solo usuarios autenticados (superadmins) pueden escribir.
    }
    
    match /landingPlans/{docId} {
      allow read: if true;
      allow write: if request.auth != null; // Solo usuarios autenticados (superadmins) pueden escribir.
    }

    // Reglas de Acceso Protegido
    // Todas las demás colecciones requieren que el usuario haya iniciado sesión.
    // Esta es una regla general. Se pueden añadir reglas más específicas por colección.
    match /companies/{companyId} {
      allow read, write: if request.auth != null;
    }

    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    match /dishes/{dishId} {
      allow read: if true; // Permitir que cualquiera lea los platos
      allow write: if request.auth != null;
    }
    
    match /orders/{orderId} {
        allow read, write: if request.auth != null;
    }

    match /reservations/{reservationId} {
      allow read, write: if request.auth != null;
    }
    
    match /supportTickets/{ticketId} {
        allow create: if request.auth != null;
        allow read, update: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'superadmin';
    }

    // Regla por defecto para cualquier otra ruta (denegar por defecto si no coincide con las anteriores)
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
